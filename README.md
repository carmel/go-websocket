# go-websocket

场景：在项目中用户会经常订阅和取消订阅一些系统消息，系统可以根据用户的订阅情况来实时的下发一些信息。
要求：简单实现一个分布式的基于websocket的消息推送系统（可使用第三方库），最好能备注设计和优化思路。


该项目采用第三方websocket库为[gorilla/websocket](github.com/gorilla/websocket)，使用nginx进行负载均衡。设计思路如下：
* Client(浏览器)请求连接服务器时，会将连接信息注册到Hub中(关闭时会在Hub中注销)；
* 收到message时，传输给Hub处理，临时存到redis中；
* Hub通过遍历基于redis list实现的消息队列将message逐个转发给每个订阅过该message所属话题的Client

优化思路：
* 减少网络小包的发送，将一定时间内N条消息合并成1条消息，合并后，每秒推送数等于在线连接数。
* 多线程并发推送集合，线程之间推送的集合不同，所以没有锁的竞争关系，避免锁竞争。
* 减少重复计算，Json编码前置，消息合并前置，N条消息合并后，只需要编码一次。
